<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>OpenCV: MultiArch cross-compilation with Ubuntu/Debian</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
          distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
          distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.9.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../df/d65/tutorial_table_of_content_introduction.html">Introduction to OpenCV</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MultiArch cross-compilation with Ubuntu/Debian </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../d0/d76/tutorial_arm_crosscompile_with_cmake.html">Cross compilation for ARM based Linux systems</a></p>
<p><b>Next Tutorial:</b> <a class="el" href="../../d6/d15/tutorial_building_tegra_cuda.html">Building OpenCV for Tegra with CUDA</a></p>
<table class="doxtable">
<tr>
<th align="right"></th><th align="left"></th></tr>
<tr>
<td align="right">Original author </td><td align="left">Kumataro </td></tr>
<tr>
<td align="right">Compatibility </td><td align="left">Ubuntu &gt;=23.04 </td></tr>
<tr>
<td align="right">^ </td><td align="left">OpenCV &gt;=4.8.0 </td></tr>
</table>
<dl class="section warning"><dt>Warning</dt><dd>This tutorial may contain obsolete information.</dd></dl>
<h2>What is "MultiArch"</h2>
<p>OpenCV may use a lot of 3rdparty libraries for video and image decoding, rendering, acceleration and complex math algorithms. The 3rd party components are found by CMake on the build host cross-compilation allows to build OpenCV for foreign architecture or OS, but we loose that large world of components and have to cross-compile each dependency separately and point to it during OpenCV build.</p>
<p>Debian/Ubuntu MultiArch helps to fix this. It allows to install several foreign architecture libraries on host system and use them during OpenCV dependencies resolution.</p>
<dl class="section warning"><dt>Warning</dt><dd><ul>
<li>Following these steps will make your Linux environment a little dirty. If possible, it is better to use VMs or Container(e.g. Docker).</li>
<li>This tutorial expects host and target uses same Ubuntu version. Do not use/mix different versions for external library dependency.<ul>
<li>Good: Host and Target are 23.04.</li>
<li>Good: Host and Target are 23.10.</li>
<li>Not Good: Host is 23.04, and Target is 23.10.</li>
<li>Not Good: Host is 23.10, and Target is 23.04.</li>
</ul>
</li>
<li>This tutorial may be used for Debian and its derivatives like Raspberry Pi OS. Please make any necessary changes.</li>
</ul>
</dd></dl>
<h2>Download tools</h2>
<p>Install necessary tools and toolchains for cross-compilation.</p>
<ul>
<li>git, cmake, pkgconf and build-essential are required basically.</li>
<li>ninja-build is to reduce compilation time(option).</li>
<li>crossbuild-essential-armhf is toolchain package for armv7 target.</li>
<li>crossbuild-essential-arm64 is toolchain package for aarch64 target.</li>
</ul>
<div class="fragment"><div class="line">sudo apt update -y</div><div class="line">sudo apt install -y \</div><div class="line">    git \</div><div class="line">    cmake \</div><div class="line">    pkgconf \</div><div class="line">    build-essential \</div><div class="line">    ninja-build \</div><div class="line">    crossbuild-essential-armhf \</div><div class="line">    crossbuild-essential-arm64</div></div><!-- fragment --><p>If you want to enable Python 3 wrapper, install these packages too.</p>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    python3-minimal \</div><div class="line">    python3-numpy</div></div><!-- fragment --><h2>Working folder structure</h2>
<p>In this tutorial, following working folder structure are used.</p>
<div class="fragment"><div class="line">/home</div><div class="line">  + kmtr                    - please replace your account name.</div><div class="line">    + work</div><div class="line">      + opencv              - source, cloned from github</div><div class="line">      + opencv_contrib      - source, cloned from github</div><div class="line">      + build4-full_arm64   - artifact(for aarch64 target), created by cmake</div><div class="line">      + build4-full_armhf   - artifact(for armhf target), created by cmake</div></div><!-- fragment --><ol type="1">
<li>Create working folder under your home directory.</li>
<li>Clone OpenCV and OpenCV Contrib from repository to work directory.</li>
</ol>
<div class="fragment"><div class="line">cd ~</div><div class="line">mkdir work</div><div class="line">cd work</div><div class="line">git clone --depth=1 https://github.com/opencv/opencv.git</div><div class="line">git clone --depth=1 https://github.com/opencv/opencv_contrib.git</div></div><!-- fragment --><h2>Update apt and dpkg settings</h2>
<p>These steps are on host.</p>
<p><code>apt</code> and <code>dpkg</code> are package management systems used in Ubuntu and Debian.</p>
<p>Following are setup steps to use MultiArch.</p>
<h3>Step 1. Add apt source for arm64 and armhf</h3>
<p>Execute <code>sudo apt edit-sources</code> to add foreign arch libraries at end of file.</p>
<p>Example 1: arm64 and armv7 for Ubuntu 23.04</p>
<div class="fragment"><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-updates main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-updates universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-updates multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-backports main restricted universe multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-security main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-security universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports lunar-security multiverse</div></div><!-- fragment --><p>Example 2: arm64 and armv7 for Ubuntu 23.10</p>
<div class="fragment"><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-updates main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-updates universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-updates multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-backports main restricted universe multiverse</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-security main restricted</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-security universe</div><div class="line">deb [arch=arm64,armhf] http://ports.ubuntu.com/ubuntu-ports mantic-security multiverse</div></div><!-- fragment --><h3>Step 2. Update apt database</h3>
<p>Update apt database to apply new apt sources.</p>
<p>Execute <code>sudo apt update</code>.</p>
<div class="fragment"><div class="line">sudo apt update</div></div><!-- fragment --><h3>Step 3. Update dpkg settings</h3>
<p>Update dpkg settings to support foreign architectures.</p>
<p>Execute <code>sudo dpkg --add-architecture arm64</code> and/or <code>sudo dpkg --add-architecture armhf</code>.</p>
<div class="fragment"><div class="line">sudo dpkg --add-architecture arm64</div><div class="line">sudo dpkg --add-architecture armhf</div></div><!-- fragment --><p><code>sudo dpkg --print-architecture</code> shows what is host architecture.</p>
<div class="fragment"><div class="line">sudo dpkg --print-architecture</div><div class="line">amd64</div></div><!-- fragment --><p>And <code>sudo dpkg --print-foreign-architectures</code> shows what foreign architectures are supported.</p>
<div class="fragment"><div class="line">sudo dpkg --print-foreign-architectures</div><div class="line">arm64</div><div class="line">armhf</div></div><!-- fragment --><h3>Confirm working pkg-config</h3>
<p>With MultiArch, several shared libraries and pkg-config information for each architectures are stored into /usr/lib.</p>
<div class="fragment"><div class="line">/usr</div><div class="line">  + lib</div><div class="line">    + aarch64-linux-gnu   - shared libraries for arm64</div><div class="line">      + pkgconfig         - pkg-config files for arm64 libraries</div><div class="line">    + arm-linux-gnueabihf - shared libraries for armhf</div><div class="line">      + pkgconfig         - pkg-config files for armhf libraries</div><div class="line">  + share</div><div class="line">    + pkgconfig         - pkg-config files(for header files)</div></div><!-- fragment --><p>Confirm to work <code>pkg-config</code> using <code>PKG_CONFIG_PATH</code>, <code>PKG_CONFIG_LIBDIR</code> and <code>PKG_CONFIG_SYSROOT_DIR</code> options.</p>
<p>for aarch64:</p>
<div class="fragment"><div class="line">PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/aarch64-linux-gnu \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">      pkg-config --list-all</div></div><!-- fragment --><p>for armv7:</p>
<div class="fragment"><div class="line">PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig \</div><div class="line">  PKG_CONFIG_LIBDIR=/usr/lib/arm-linux-gnueabihf \</div><div class="line">  PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">      pkg-config --list-all</div></div><!-- fragment --><h2>Cross-compile for aarch64</h2>
<p>Following is to compile for target (aarch64) at host (x86-64).</p>
<h3>Step 1. Install external libraries for target into host</h3>
<p>This step is on host.</p>
<p>Install libfreetype-dev, libharfbuzz-dev and FFmpeg packages for target (arm64) into host (x86-64).</p>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    libavcodec-dev:arm64 \</div><div class="line">    libavformat-dev:arm64 \</div><div class="line">    libavutil-dev:arm64 \</div><div class="line">    libswscale-dev:arm64 \</div><div class="line">    libfreetype-dev:arm64 \</div><div class="line">    libharfbuzz-dev:arm64</div></div><!-- fragment --><p>If you want to enable Python 3 wrapper, install these packages too.</p>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    libpython3-dev:arm64</div></div><!-- fragment --><p>If succeed, pkg-config can show information about these packages.</p>
<p>For Freetype2 and Harfbuzz:</p>
<div class="fragment"><div class="line">PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/aarch64-linux-gnu \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">       pkg-config freetype2 harfbuzz --cflags --libs</div><div class="line">-I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/harfbuzz -I/usr/include/glib-2.0 -I/usr/lib/aarch64-linux-gnu/glib-2.0/include -L/usr/lib/aarch64-linux-gnu -lfreetype -lharfbuzz</div></div><!-- fragment --><p>For FFmpeg:</p>
<div class="fragment"><div class="line">PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/aarch64-linux-gnu \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">       pkg-config libavcodec libavformat libavutil libswscale --cflags --libs</div><div class="line">-I/usr/include/aarch64-linux-gnu -L/usr/lib/aarch64-linux-gnu -lavcodec -lavformat -lavutil -lswscale</div></div><!-- fragment --><h3>Step 2. Configure OpenCV Settings</h3>
<p>This step is on host.</p>
<p>Execute <code>cmake</code> to make cross-compile configuration for aarch64.</p>
<dl class="section note"><dt>Note</dt><dd><code>-DCMAKE_TOOLCHAIN_FILE</code> should be absolute/real file path, not relative path.</dd></dl>
<div class="fragment"><div class="line">PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/aarch64-linux-gnu \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">        cmake -S opencv \</div><div class="line">              -B build4-full_arm64 \</div><div class="line">              -DCMAKE_TOOLCHAIN_FILE=/home/kmtr/work/opencv/platforms/linux/aarch64-gnu.toolchain.cmake \</div><div class="line">              -DOPENCV_EXTRA_MODULES_PATH=opencv_contrib/modules \</div><div class="line">              -GNinja</div></div><!-- fragment --><p>If you want to enable Python 3 wrapper, extra options are needed.</p>
<div class="fragment"><div class="line">PYTHON3_REALPATH=`realpath /usr/bin/python3`</div><div class="line">PYTHON3_BASENAME=`basename ${PYTHON3_REALPATH}`</div><div class="line">PKG_CONFIG_PATH=/usr/lib/aarch64-linux-gnu/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/aarch64-linux-gnu \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">        cmake -S opencv \</div><div class="line">              -B build4-full_arm64 \</div><div class="line">              -DCMAKE_TOOLCHAIN_FILE=/home/kmtr/work/opencv/platforms/linux/aarch64-gnu.toolchain.cmake \</div><div class="line">              -DOPENCV_EXTRA_MODULES_PATH=opencv_contrib/modules \</div><div class="line">              -DPYTHON3_NUMPY_INCLUDE_DIRS=&quot;/usr/local/lib/${PYTHON3_BASENAME}/dist-packages/numpy/core/include/&quot; \</div><div class="line">              -DPYTHON3_INCLUDE_PATH=&quot;/usr/include/${PYTHON3_BASENAME};/usr/include/&quot; \</div><div class="line">              -DPYTHON3_LIBRARIES=`find /usr/lib/aarch64-linux-gnu/ -name libpython*.so` \</div><div class="line">              -DPYTHON3_EXECUTABLE=&quot;/usr/bin/${PYTHON3_BASENAME}&quot; \</div><div class="line">              -DPYTHON3_CVPY_SUFFIX=&quot;.so&quot; \</div><div class="line">              -GNinja</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Lastly, "python3.XX" string is needed. So this script generate it.<ul>
<li>Get real path from "/usr/bin/python3" to "/usr/bin/python3.xx".</li>
<li>Get base name from "/usr/bin/python3.xx" to "pyhton3.xx". </li>
</ul>
</dd></dl>
<p>Following is cmake outputs.</p><ul>
<li><code>Host</code> is <code>Linux x86_64</code>.</li>
<li><code>Target</code> is <code>Linux aarch64</code>.</li>
<li>FFmpeg is available.</li>
</ul>
<div class="fragment"><div class="line">-- General configuration for OpenCV 4.8.0-dev =====================================</div><div class="line">--   Version control:               408730b</div><div class="line">--</div><div class="line">--   Extra modules:</div><div class="line">--     Location (extra):            /home/kmtr/work/opencv_contrib/modules</div><div class="line">--     Version control (extra):     faa5468</div><div class="line">--</div><div class="line">--   Platform:</div><div class="line">--     Timestamp:                   2023-12-01T22:02:14Z</div><div class="line">--     Host:                        Linux 6.5.0-13-generic x86_64</div><div class="line">--     Target:                      Linux 1 aarch64</div><div class="line">--     CMake:                       3.27.4</div><div class="line">--     CMake generator:             Ninja</div><div class="line">--     CMake build tool:            /usr/bin/ninja</div><div class="line">--     Configuration:               Release</div><div class="line">--</div><div class="line">--   CPU/HW features:</div><div class="line">--     Baseline:                    NEON FP16</div><div class="line">--       required:                  NEON</div><div class="line">--       disabled:                  VFPV3</div><div class="line">--     Dispatched code generation:  NEON_DOTPROD NEON_FP16 NEON_BF16</div><div class="line">--       requested:                 NEON_FP16 NEON_BF16 NEON_DOTPROD</div><div class="line">--       NEON_DOTPROD (1 files):    + NEON_DOTPROD</div><div class="line">--       NEON_FP16 (2 files):       + NEON_FP16</div><div class="line">--       NEON_BF16 (0 files):       + NEON_BF16</div><div class="line">--</div><div class="line">--   C/C++:</div><div class="line">--     Built as dynamic libs?:      YES</div><div class="line">--     C++ standard:                11</div><div class="line">--     C++ Compiler:                /usr/bin/aarch64-linux-gnu-g++  (ver 13.2.0)</div><div class="line"></div><div class="line">:</div><div class="line">:</div><div class="line"></div><div class="line">--</div><div class="line">--   Video I/O:</div><div class="line">--     DC1394:                      NO</div><div class="line">--     FFMPEG:                      YES</div><div class="line">--       avcodec:                   YES (60.3.100)</div><div class="line">--       avformat:                  YES (60.3.100)</div><div class="line">--       avutil:                    YES (58.2.100)</div><div class="line">--       swscale:                   YES (7.1.100)</div><div class="line">--       avresample:                NO</div><div class="line">--     GStreamer:                   NO</div><div class="line">--     v4l/v4l2:                    YES (linux/videodev2.h)</div><div class="line">--</div></div><!-- fragment --><p>If enabling Python 3 wrapper is succeeded, <code>Python 3:</code> section shows more.</p>
<div class="fragment"><div class="line">--</div><div class="line">--   Python 3:</div><div class="line">--     Interpreter:                 /usr/bin/python3.11 (ver 3.11.6)</div><div class="line">--     Libraries:                   /usr/lib/aarch64-linux-gnu/libpython3.11.so</div><div class="line">--     numpy:                       /usr/local/lib/python3.11/dist-packages/numpy/core/include/ (ver undefined - cannot be probed because of the cross-compilation)</div><div class="line">--     install path:                lib/python3.11/dist-packages/cv2/python-3.11</div><div class="line">--</div><div class="line">--   Python (for build):            /usr/bin/python3.11</div><div class="line">--</div></div><!-- fragment --><h3>Step 3. Build and archive OpenCV libraries and headers</h3>
<p>This step in in host.</p>
<p>Build and install. (This <code>install</code> means only that copying artifacts to <code>install</code> folder.)</p>
<div class="fragment"><div class="line">     cmake --build   build4-full_arm64</div><div class="line">sudo cmake --install build4-full_arm64</div></div><!-- fragment --><p>Archive artifacts(built libraries and headers) to <code>opencv_arm64.tgz</code> with tar command.</p>
<div class="fragment"><div class="line">tar czvf opencv_arm64.tgz -C build4-full_arm64/install .</div></div><!-- fragment --><p>And send <code>opencv_arm64.tgz</code> to target.</p>
<h3>Step 4. Install dependency libraries at target</h3>
<p>This step is executed on the target system.</p>
<p>Install dependency run-time libraries for OpenCV/OpenCV contrib libraries at target.</p>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    libavcodec60 \</div><div class="line">    libavformat60 \</div><div class="line">    libavutil58 \</div><div class="line">    libswscale7 \</div><div class="line">    libfreetype6 \</div><div class="line">    libharfbuzz0b</div><div class="line"></div><div class="line">sudo ldconfig</div></div><!-- fragment --><p>If you want to enable Python 3 wrapper, install these packages too.</p>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    python3-minimal \</div><div class="line">    python3-numpy</div></div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>If version of runtime libraries and/or programs are incremented, apt package names may be changed (e.g. <code>libswscale6</code> is used for Ubuntu 23.04, but <code>libswscale7</code> is used for Ubuntu 23.10). Looking for it with <code>apt search</code> command or <a href="https://packages.ubuntu.com/">https://packages.ubuntu.com/</a> . </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><p class="startdd">External library version between host and target should be same. Please update to the latest version libraries at the same time as possible.</p>
<p>Even if the OS versions are the same between the Host and Target, the versions may differ due to additional updates to the libraries. This will cause unexpected problems.</p>
<p class="enddd">For example)</p><ul>
<li>On Host, OpenCV has been build with external libA (v1.0) for target.</li>
<li>libA (v1.1) may be updated.</li>
<li>On Target, libA (v1.1) is installed to use OpenCV.</li>
<li>In this case, versions of libA is difference between compiling and running. </li>
</ul>
</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><p class="startdd">If you forget/mismatch to install some necessary libraries, OpenCV will not works well.</p>
<p><code>ldd</code> command can detect dependency. If there are any "not found", please install necessary libraries.</p>
<div class="fragment"><div class="line">ldd /usr/local/lib/libopencv_freetype.so</div></div><!-- fragment --><p>(Not Good) <code>freetype module</code> requires <code>libharfbuzz.so.0</code>, but it has not been installed. </p><div class="fragment"><div class="line">linux-vdso.so.1 (0xABCDEFG01234567)</div><div class="line">libopencv_imgproc.so.408 =&gt; /usr/local/lib/libopencv_imgproc.so.408 (0xABCDEF001234567)</div><div class="line">libfreetype.so.6 =&gt; /lib/aarch64-linux-gnu/libfreetype.so.6 (0xABCDEF001234567)</div><div class="line">libharfbuzz.so.0 =&gt; not found</div><div class="line">libopencv_core.so.408 =&gt; /usr/local/lib/libopencv_core.so.408 (0xABCDEF001234567)</div><div class="line">:</div></div><!-- fragment --><p class="enddd">(Good) All libraries which are required from <code>freetype modules</code> are installed. </p><div class="fragment"><div class="line">linux-vdso.so.1 (0xABCDEFG01234567)</div><div class="line">libopencv_imgproc.so.408 =&gt; /usr/local/lib/libopencv_imgproc.so.408 (0xABCDEF001234567)</div><div class="line">libfreetype.so.6 =&gt; /lib/aarch64-linux-gnu/libfreetype.so.6 (0xABCDEF001234567)</div><div class="line">libharfbuzz.so.0 =&gt; /lib/aarch64-linux-gnu/libharfbuzz.so.0 (0xABCDEF001234567)</div><div class="line">libopencv_core.so.408 =&gt; /usr/local/lib/libopencv_core.so.408 (0xABCDEF001234567)</div><div class="line">:</div></div><!-- fragment --> </dd></dl>
<h3>Step 5. Install OpenCV libraries to target</h3>
<p>This step is on target.</p>
<p>Receive <code>opencv_arm64.tgz</code> from host (generated at Step3), and extract to <code>/usr/local</code>.</p>
<div class="fragment"><div class="line">sudo tar zxvf opencv_arm64.tgz -C /usr/local</div><div class="line">sudo ldconfig</div></div><!-- fragment --><p>You can use OpenCV libraries same as self-compiling. Following is OpenCV sample code. Compile and run it on target.</p>
<p>Makefile </p><div class="fragment"><div class="line">a.out : main.cpp</div><div class="line">    g++ main.cpp -o a.out \</div><div class="line">        -I/usr/local/include/opencv4 \</div><div class="line">        -lopencv_core</div></div><!-- fragment --><p>main.cpp </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d0/d9c/core_2include_2opencv2_2core_8hpp.html">opencv2/core.hpp</a>&gt;</span></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <a class="code" href="../../db/de0/group__core__utils.html#ga0ae377100bc03ce22322926bba7fdbb5">cv::getBuildInformation</a>() &lt;&lt; std::endl;</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Execute <code>make</code> and run it. </p><div class="fragment"><div class="line">make a.out</div><div class="line">./a.out</div></div><!-- fragment --><p>If you want to enable Python 3 wrapper, execute following command to confirm.</p>
<div class="fragment"><div class="line">python3 -c &quot;import cv2; print(cv2.getBuildInformation())&quot;</div></div><!-- fragment --><h2>Cross-compile for armv7</h2>
<p>Following is to compile for target (armhf) at host (x86-64).</p>
<ul>
<li>To resolve dependencies, <code>linux-libc-dev:armhf</code> is required.</li>
<li>To optimize with neon, <code>-DENABLE_NEON=ON</code> is needed.</li>
</ul>
<div class="fragment"><div class="line">sudo apt install -y \</div><div class="line">    linux-libc-dev:armhf \</div><div class="line">    libavcodec-dev:armhf \</div><div class="line">    libavformat-dev:armhf \</div><div class="line">    libavutil-dev:armhf \</div><div class="line">    libswscale-dev:armhf \</div><div class="line">    libfreetype-dev:armhf \</div><div class="line">    libharfbuzz-dev:armhf</div><div class="line"></div><div class="line">PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig \</div><div class="line">    PKG_CONFIG_LIBDIR=/usr/lib/arm-linux-gnueabihf \</div><div class="line">    PKG_CONFIG_SYSROOT_DIR=/ \</div><div class="line">        cmake -S opencv \</div><div class="line">              -B build4-full_armhf \</div><div class="line">              -DENABLE_NEON=ON \</div><div class="line">              -DCMAKE_TOOLCHAIN_FILE=/home/kmtr/work/opencv/platforms/linux/arm-gnueabi.toolchain.cmake \</div><div class="line">              -DOPENCV_EXTRA_MODULES_PATH=opencv_contrib/modules \</div><div class="line">              -GNinja</div><div class="line"></div><div class="line">cmake      --build   build4-full_armhf</div><div class="line">sudo cmake --install build4-full_armhf</div><div class="line">tar czvf opencv_armhf.tgz -C build4-full_armhf/install .</div></div><!-- fragment --><p>Following is cmake outputs.</p><ul>
<li><code>Host</code> is <code>Linux x86_64</code>.</li>
<li><code>Target</code> is <code>Linux arm</code>.</li>
<li>FFmpeg is available.</li>
</ul>
<div class="fragment"><div class="line">-- General configuration for OpenCV 4.8.0-dev =====================================</div><div class="line">--   Version control:               408730b</div><div class="line">--</div><div class="line">--   Extra modules:</div><div class="line">--     Location (extra):            /home/kmtr/work/opencv_contrib/modules</div><div class="line">--     Version control (extra):     faa5468</div><div class="line">--</div><div class="line">--   Platform:</div><div class="line">--     Timestamp:                   2023-12-02T03:39:58Z</div><div class="line">--     Host:                        Linux 6.5.0-13-generic x86_64</div><div class="line">--     Target:                      Linux 1 arm</div><div class="line">--     CMake:                       3.27.4</div><div class="line">--     CMake generator:             Ninja</div><div class="line">--     CMake build tool:            /usr/bin/ninja</div><div class="line">--     Configuration:               Release</div><div class="line">--</div><div class="line">--   CPU/HW features:</div><div class="line">--     Baseline:                    NEON</div><div class="line">--       requested:                 DETECT</div><div class="line">--       required:                  NEON</div><div class="line">--       disabled:                  VFPV3</div><div class="line">--</div><div class="line">--   C/C++:</div><div class="line">--     Built as dynamic libs?:      YES</div><div class="line">--     C++ standard:                11</div><div class="line">--     C++ Compiler:                /usr/bin/arm-linux-gnueabihf-g++  (ver 13.2.0)</div><div class="line"></div><div class="line">:</div><div class="line">:</div><div class="line"></div><div class="line">--</div><div class="line">--   Video I/O:</div><div class="line">--     DC1394:                      NO</div><div class="line">--     FFMPEG:                      YES</div><div class="line">--       avcodec:                   YES (60.3.100)</div><div class="line">--       avformat:                  YES (60.3.100)</div><div class="line">--       avutil:                    YES (58.2.100)</div><div class="line">--       swscale:                   YES (7.1.100)</div><div class="line">--       avresample:                NO</div><div class="line">--     GStreamer:                   NO</div><div class="line">--     v4l/v4l2:                    YES (linux/videodev2.h)</div><div class="line">--</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 27 2023 21:56:13 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
