<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>OpenCV: Barcode Recognition</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
          distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
          distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.9.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d3/dd5/tutorial_table_of_content_other.html">Other tutorials (ml, objdetect, photo, stitching, video)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Barcode Recognition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../dc/d88/tutorial_traincascade.html">Cascade Classifier Training</a></p>
<p><b>Next Tutorial:</b> <a class="el" href="../../d1/d73/tutorial_introduction_to_svm.html">Introduction to Support Vector Machines</a></p>
<table class="doxtable">
<tr>
<th align="right"></th><th align="left"></th></tr>
<tr>
<td align="right">Compatibility </td><td align="left">OpenCV &gt;= 4.8 </td></tr>
</table>
<h2>Goal </h2>
<p>In this chapter we will familiarize with the barcode detection and decoding methods available in OpenCV.</p>
<h2>Basics </h2>
<p>Barcode is major technique to identify commodity in real life. A common barcode is a pattern of parallel lines arranged by black bars and white bars with vastly different reflectivity. Barcode recognition is to scan the barcode in the horizontal direction to get a string of binary codes composed of bars of different widths and colors, that is, the code information of the barcode. The content of barcode can be decoded by matching with various barcode encoding methods. Currently, we support EAN-8, EAN-13, UPC-A and UPC-E standards.</p>
<p>See <a href="https://en.wikipedia.org/wiki/Universal_Product_Code">https://en.wikipedia.org/wiki/Universal_Product_Code</a> and <a href="https://en.wikipedia.org/wiki/International_Article_Number">https://en.wikipedia.org/wiki/International_Article_Number</a></p>
<p>Related papers: <a class="el" href="../../d0/de3/citelist.html#CITEREF_Xiangmin2015research">[299]</a> , <a class="el" href="../../d0/de3/citelist.html#CITEREF_kass1987analyzing">[140]</a> , <a class="el" href="../../d0/de3/citelist.html#CITEREF_bazen2002systematic">[21]</a></p>
<h2>Code example </h2>
<h3>Main class</h3>
<p>Several algorithms were introduced for barcode recognition.</p>
<p>While coding, we firstly need to create a <a class="el" href="../../dc/df7/classcv_1_1barcode_1_1BarcodeDetector.html">cv::barcode::BarcodeDetector</a> object. It has mainly three member functions, which will be introduced in the following.</p>
<h4>Initialization</h4>
<p>Optionally user can construct barcode detector with super resolution model which should be downloaded from <a href="https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode">https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode</a> (<code>sr.caffemodel</code>, <code>sr.prototxt</code>).</p>
<div class="fragment"><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        app.bardet = makePtr&lt;barcode::BarcodeDetector&gt;(sr_prototxt, sr_model);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e)</div><div class="line">    {</div><div class="line">        cout &lt;&lt;</div><div class="line">             <span class="stringliteral">&quot;\n---------------------------------------------------------------\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Failed to initialize super resolution.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Please, download &#39;sr.*&#39; from\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;and put them into the current directory.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Or you can leave sr_prototxt and sr_model unspecified.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;---------------------------------------------------------------\n&quot;</span>;</div><div class="line">        cout &lt;&lt; e.what() &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div></div><!-- fragment --><p> We need to create variables to store the outputs.</p>
<div class="fragment"><div class="line">    vector&lt;Point&gt; corners;</div><div class="line">    vector&lt;string&gt; decode_info;</div><div class="line">    vector&lt;string&gt; decode_type;</div></div><!-- fragment --> <h4>Detecting</h4>
<p><a class="el" href="../../d7/d90/classcv_1_1GraphicalCodeDetector.html#ad28ae6b728add0ca8538ea0fc9d61732" title="Detects graphical code in image and returns the quadrangle containing the code. ">cv::barcode::BarcodeDetector::detect</a> method uses an algorithm based on directional coherence. First, we compute the average squared gradients of every pixel, <a class="el" href="../../d0/de3/citelist.html#CITEREF_bazen2002systematic">[21]</a> . Then we divide an image into square patches and compute the <b>gradient orientation coherence</b> and <b>mean gradient direction</b> of each patch. Then, we connect all patches that have <b>high gradient orientation coherence</b> and <b>similar gradient direction</b>. At this stage we use multiscale patches to capture the gradient distribution of multi-size barcodes, and apply non-maximum suppression to filter duplicate proposals. At last, we use <a class="el" href="../../d3/dc0/group__imgproc__shape.html#ga3d476a3417130ae5154aea421ca7ead9" title="Finds a rotated rectangle of the minimum area enclosing the input 2D point set. ">cv::minAreaRect</a> to bound the ROI, and output the corners of the rectangles.</p>
<p>Detect codes in the input image, and output the corners of detected rectangles:</p>
<div class="fragment"><div class="line">            bardet-&gt;detectMulti(frame, corners);</div></div><!-- fragment --> <h4>Decoding</h4>
<p><a class="el" href="../../d7/d90/classcv_1_1GraphicalCodeDetector.html#a27be30f41b577d3e7e1c594ab38df054" title="Decodes graphical code in image once it&#39;s found by the detect() method. ">cv::barcode::BarcodeDetector::decode</a> method first super-scales the image (<em>optionally</em>) if it is smaller than threshold, sharpens the image and then binaries it by OTSU or local binarization. Then it reads the contents of the barcode by matching the similarity of the specified barcode pattern.</p>
<h4>Detecting and decoding</h4>
<p><a class="el" href="../../d7/d90/classcv_1_1GraphicalCodeDetector.html#a878307029654e43ee8bee1c99efdbdc0" title="Both detects and decodes graphical code. ">cv::barcode::BarcodeDetector::detectAndDecode</a> combines <code>detect</code> and <code>decode</code> in a single call. A simple example below shows how to use this function:</p>
<div class="fragment"><div class="line">            bardet-&gt;detectAndDecodeWithType(frame, decode_info, decode_type, corners);</div></div><!-- fragment --><p> Visualize the results:</p>
<div class="fragment"><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; corners.size(); i += 4)</div><div class="line">        {</div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx = i / 4;</div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">bool</span> isDecodable = idx &lt; decode_info.size()</div><div class="line">                &amp;&amp; idx &lt; decode_type.size()</div><div class="line">                &amp;&amp; !decode_type[idx].empty();</div><div class="line">            <span class="keyword">const</span> <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a> lineColor = isDecodable ? greenColor : redColor;</div><div class="line">            <span class="comment">// draw barcode rectangle</span></div><div class="line">            vector&lt;Point&gt; contour(corners.begin() + i, corners.begin() + i + 4);</div><div class="line">            <span class="keyword">const</span> vector&lt; vector&lt;Point&gt; &gt; contours {contour};</div><div class="line">            <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga746c0625f1781f1ffc9056259103edbc">drawContours</a>(frame, contours, 0, lineColor, 1);</div><div class="line">            <span class="comment">// draw vertices</span></div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; 4; j++)</div><div class="line">                <a class="code" href="../../d9/db7/group__datasets__gr.html#gga610754124ced68d1f05760b5948fbb76a6f0d8b2d9e3e947b2a5c1eff9e81ee95">circle</a>(frame, contour[j], 2, randColor(), -1);</div><div class="line">            <span class="comment">// write decoded text</span></div><div class="line">            <span class="keywordflow">if</span> (isDecodable)</div><div class="line">            {</div><div class="line">                ostringstream buf;</div><div class="line">                buf &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; decode_type[idx] &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; decode_info[idx];</div><div class="line">                <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">putText</a>(frame, buf.str(), contour[1], <a class="code" href="../../d6/d6e/group__imgproc__draw.html#gga0f9314ea6e35f99bb23f29567fc16e11af7b1b25521fc9b5731a97cfd13460c2a">FONT_HERSHEY_COMPLEX</a>, 0.8, yellowColor, 1);</div><div class="line">            }</div><div class="line">        }</div></div><!-- fragment --> <h2>Results </h2>
<p>Original image:</p>
<div class="image">
<img src="../../barcode_book.jpg" alt="barcode_book.jpg"/>
<div class="caption">
image</div></div>
<p> After detection:</p>
<div class="image">
<img src="../../barcode_book_res.jpg" alt="barcode_book_res.jpg"/>
<div class="caption">
image</div></div>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Dec 27 2023 21:56:13 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
